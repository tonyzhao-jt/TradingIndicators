# small code / no code snippets 
```
"risk_management": {
    "description": "If the price of QQQ goes 30% above the 200SMA of QQQ, deleverage to QQQ or Sell to protect yourself from dot com level event.",
    "code": "Note: (if the price of QQQ goes 30% above the 200SMA of QQQ deleverage to QQQ or Sell to protect yourself from dot com level event)"
},
```

# Repeatition

```
    "filtering_sys": {
    "description": "The strategy uses the 200-day Simple Moving Average (SMA) as a filter to determine market trend direction.",
    "code": "sma200         = ta.sma(close, smaLength)"
    },
    "smart_money": {
    "description": "This strategy reflects institutional logic by using a long-term moving average to identify major trends and aligning trades with broader market sentiment.",
    "code": "sma200         = ta.sma(close, smaLength)"
    },
```

# other LANGUAGE
```
  {
    "instruction": "Please analyze the following trading strategy description and provide a step-by-step reasoning process for implementing it in Pine Script, followed by the complete implementation (Trading view Pinescript).",
    "input": "전략 이름열반의 진검승부 (영문: Nirvana True Duel)컨셉과 철학“열반의 진검승부”는 시장 소음은 무시하고, 확실할 때만 진입하는 전략입니다.EMA 리본으로 추세 방향을 확인하고, 볼린저 밴드 수축/확장으로 변동성 돌파를 포착하며, OBV로 거래량 확인을 통해 가짜 돌파를 필터링합니다.전략 로직매수 조건 (롱)20EMA > 50EMA (상승 추세)밴드폭 수축 후 확장 시작종가가 상단 밴드 돌파OBV 상승 흐름 유지매도 조건 (숏)20EMA < 50EMA (하락 추세)밴드폭 수축 후 확장 시작종가가 하단 밴드 이탈OBV 하락 흐름 유지진입·청산손절: ATR × 1.5 배수익절: 손절폭의 1.5~2배에서 부분 청산시간 청산: 설정한 최대 보유 봉수 초과 시 강제 청산장점✅ 추세·변동성·거래량 3중 필터 → 노이즈 최소화✅ 백테스트·알람 지원 → 기계적 매매 가능✅ 5분/15분 차트에 적합 → 단타/스윙 트레이딩 활용 가능주의점⚠ 횡보장에서는 신호가 적거나 실패 가능⚠ 수수료·슬리피지 고려 필요📜 Nirvana True Duel — Strategy Description (English)Name:Nirvana True Duel (a.k.a. Nirvana Cross)Concept & PhilosophyThe “Nirvana True Duel” strategy focuses on trading only meaningful breakouts and avoiding unnecessary noise.Nirvana: A calm, patient state — waiting for the right opportunity without emotional trading.True Duel: When the signal appears, enter decisively and let the market reveal the outcome.In short: “Ignore market noise, trade only high-probability breakouts.”🧩 Strategy ComponentsTrend Filter (EMA Ribbon): Stay aligned with the main market trend.Volatility Squeeze (Bollinger Band): Detect volatility contraction & expansion to catch explosive moves early.Volume Confirmation (OBV): Filter out false breakouts by confirming with volume flow.⚔️ Entry & Exit ConditionsLong Setup:20 EMA > 50 EMA (uptrend)BB width breaks out from recent squeezeClose > Upper Bollinger BandOBV shows positive flowShort Setup:20 EMA < 50 EMA (downtrend)BB width breaks out from recent squeezeClose < Lower Bollinger BandOBV shows negative flowRisk Management:Stop Loss: ATR × 1.5 below/above entryTake Profit: 1.5–2× stop distance, partial take-profit allowedTime Stop: Automatically closes after max bars held (e.g. 8h on 5m chart)✅ StrengthsTriple Filtering: Trend + Volatility + Volume → fewer false signalsMechanical & Backtestable: Ideal for objective trading & performance validationAdaptable: Works well on Bitcoin, Nasdaq futures, and other high-volatility markets (5m/15m)⚠️ Things to NoteLow signal frequency or higher failure rate in sideways/range marketsCommission & slippage should be factored in, especially on lower timeframesATR multiplier and R:R ratio should be optimized per asset",
    "output": "## Step 1: Requirement Analysis\n\nThe Nirvana True Duel strategy requires a multi-layered approach to trade entry and exit decisions based on three core filters: trend direction (via EMA ribbon), volatility dynamics (via Bollinger Band squeeze), and volume confirmation (via OBV). The goal is to identify high-probability breakout setups by ensuring alignment across these three components. \n\nKey requirements:\n- Long entry when fast EMA > slow EMA (uptrend) AND BB width expands after contraction AND close > upper BB AND OBV is rising.\n- Short entry when fast EMA < slow EMA (downtrend) AND BB width expands after contraction AND close < lower BB AND OBV is falling.\n- Risk management via ATR-based stops and take profits with partial profit taking options.\n- Time-based exit after maximum holding period (time stop).\n- Visual indicators and alerts for trade triggers.\n- Configurable parameters for adaptability across different assets/timeframes.\n\n## Step 2: Technical Indicator Selection\n\nTo implement this strategy, we'll use several core Pine Script functions and built-in indicators:\n- `ta.ema()` for computing exponential moving averages (fast and slow).\n- `ta.sma()` and `ta.stdev()` for constructing Bollinger Bands.\n- `ta.atr()` for calculating Average True Range to determine stop loss and take profit distances.\n- `ta.cum()` and `ta.sma()` for On-Balance Volume (OBV) calculation and smoothing.\n- `ta.lowest()` for detecting volatility squeeze conditions.\n- `math.sign()` and `ta.change()` to compute OBV properly.\n\nWe also need to calculate band width as a percentage of basis to normalize it across different price levels.\n\n## Step 3: Signal Logic Design\n\nThe logic for generating buy/sell signals involves checking multiple conditions simultaneously:\n- Trend filter: Fast EMA crossing above/below slow EMA.\n- Volatility filter: Band width must contract then expand (squeezeExpand = previous bar was in-squeeze, current is not).\n- Price action filter: Close breaking outside upper/lower Bollinger Band.\n- Volume filter: OBV must be trending up/down accordingly.\n\nAdditionally, we must ensure no conflicting positions exist at the time of entry (i.e., long-only if currently flat or short, vice versa).\n\nEntry conditions are encapsulated in boolean flags (`longTrig`, `shortTrig`) that combine all four filters. These will be used to trigger orders using `strategy.entry()`.\n\n## Step 4: Implementation Planning\n\nFirst, define input parameters for customization:\n- EMA lengths, BB settings, squeeze lookback/threshold, OBV smoothing period, ATR length/multiplier, risk/reward ratio.\n- Position sizing options (percentage of equity or fixed quantity).\n- Max bars to hold (time stop duration).\n\nNext, compute required indicators:\n- EMA ribbon (fast vs slow).\n- Bollinger Bands with dynamic width metric.\n- OBV with SMA smoothing.\n- ATR for risk controls.\n\nThen, create logical conditions:\n- Determine whether current bar is in a squeeze and if it just expanded.\n- Identify bullish/bearish trends from EMA relationship.\n- Check if close crosses upper/lower bands.\n- Validate OBV trend direction.\n\nFinally, apply risk management:\n- Calculate stop loss and take profit levels using ATR × multiplier.\n- Set partial take-profit logic based on RR ratio.\n- Implement time-based closure logic using a variable tracking entry bar index.\n\n## Step 5: Parameter Considerations\n\nSeveral parameters should be made user-configurable to enhance strategy flexibility:\n- EMA fast/slow lengths (defaulting to 20/50).\n- BB length and standard deviation multiplier.\n- Squeeze lookback window and threshold multiplier.\n- OBV smoothing period.\n- ATR length and stop loss multiplier.\n- Risk/reward ratio for take profit calculation.\n- Position size type (percentage or fixed).\n- Maximum bars to hold (for time stop).\n- Commission and pyramiding settings.\n\nEach parameter must be carefully chosen depending on asset characteristics (e.g., volatility, liquidity) and timeframe (e.g., 5m vs 15m charts). Some may require optimization per instrument.\n\n## Step 6: Visualization Planning\n\nVisual elements should clearly communicate the strategy’s behavior:\n- Plot EMA ribbon (fast and slow) to show trend direction.\n- Overlay Bollinger Bands with color-coded basis, upper, and lower lines.\n- Highlight periods where BB is squeezed with background color change.\n- Display entry signals with shape markers (buy/sell labels).\n- Optionally add labels or annotations to indicate active trades or exits.\n\nAlert conditions should be created for both long and short triggers so users can receive notifications directly in TradingView.\n\nLastly, ensure proper handling of visual updates for dynamic elements like OBV trends and band expansions. Use `plotshape()` for discrete signal points and `bgcolor()` for continuous squeeze visualization.\n\n## Pine Script Implementation:\n\n```pinescript\n//@version=5strategy(\"Nirvana True Duel — EMA Ribbon + BB Squeeze + OBV (Backtest)\",     overlay=true,     initial_capital=100000,     commission_type=strategy.commission.percent,     commission_value=0.02,     pyramiding=0,     calc_on_every_tick=true,     calc_on_order_fills=true)// === Inputs ===emaFastLen   = input.int(20, \"EMA Fast Length\")emaSlowLen   = input.int(50, \"EMA Slow Length\")bbLength     = input.int(20, \"BB Length\")bbMult       = input.float(2.0, \"BB StdDev Mult\")squeezeLookback = input.int(20, \"Squeeze Lookback\")squeezeK        = input.float(1.2, \"Squeeze Threshold (↑=느슨)\")obvLen      = input.int(14, \"OBV Smoothing\")atrLen      = input.int(14, \"ATR Length\")atrMultSL   = input.float(1.5, \"Stop ATR x\")rr          = input.float(1.5, \"Risk:Reward\")usePctQty   = input.bool(true, \"Use % of Equity\")qtyPct      = input.float(10.0, \"Position Size (%)\")fixedQty    = input.float(1.0, \"Fixed Qty\")// 보유 최대 봉수(시간 제한 청산)maxBarsHold = input.int(96, \"Max Bars to Hold (time stop)\", minval=1,   tooltip=\"5분봉 기준 96=8시간, 15분봉 기준 96=24시간\")// === Indicators ===emaFast = ta.ema(close, emaFastLen)emaSlow = ta.ema(close, emaSlowLen)bullTrend = emaFast > emaSlowbearTrend = emaFast < emaSlowbasis = ta.sma(close, bbLength)dev   = bbMult * ta.stdev(close, bbLength)upper = basis + devlower = basis - devbbWidth = (upper - lower) / basisobv = ta.cum(math.sign(ta.change(close)) * volume)obv_sma = ta.sma(obv, obvLen)obv_up  = obv > obv_smaobv_dn  = obv < obv_sma// === Logic ===inSqueeze     = bbWidth <= ta.lowest(bbWidth, squeezeLookback) * squeezeKsqueezeExpand = (not inSqueeze) and inSqueeze[1]longTrig  = close > upper and bullTrend and obv_up and squeezeExpandshortTrig = close < lower and bearTrend and obv_dn and squeezeExpand// === Risk (ATR) ===atr = ta.atr(atrLen)longSL  = strategy.position_avg_price - atrMultSL * atrlongTP  = strategy.position_avg_price + (atrMultSL * rr) * atrshortSL = strategy.position_avg_price + atrMultSL * atrshortTP = strategy.position_avg_price - (atrMultSL * rr) * atr// === Qty ===qty = usePctQty ? strategy.equity * qtyPct * 0.01 / close : fixedQty// === Entries ===canLong  = longTrig  and strategy.position_size <= 0canShort = shortTrig and strategy.position_size >= 0if canLong    strategy.entry(\"NTD_Long\", strategy.long, qty=qty)if canShort    strategy.entry(\"NTD_Short\", strategy.short, qty=qty)// === ATR exits ===if strategy.position_size > 0    strategy.exit(\"NTD_Long_Exit\",  from_entry=\"NTD_Long\",  stop=longSL,  limit=longTP)if strategy.position_size < 0    strategy.exit(\"NTD_Short_Exit\", from_entry=\"NTD_Short\", stop=shortSL, limit=shortTP)// === Time-based safety exit ===var int entryBar = na// 새 진입 시점 기록if strategy.position_size != 0 and strategy.position_size[1] == 0    entryBar := bar_index// 포지션 청산 시 초기화if strategy.position_size == 0 and strategy.position_size[1] != 0    entryBar := nabarsHeld = strategy.position_size != 0 and entryBar != na ? (bar_index - entryBar) : 0if strategy.position_size > 0 and barsHeld >= maxBarsHold    strategy.close(\"NTD_Long\",   comment=\"Time Stop\")if strategy.position_size < 0 and barsHeld >= maxBarsHold    strategy.close(\"NTD_Short\",  comment=\"Time Stop\")// === Visuals & Alerts ===plot(emaFast, \"EMA Fast\", color=color.new(color.yellow, 0))plot(emaSlow, \"EMA Slow\", color=color.new(color.orange, 0))plot(basis,   \"BB Basis\", color=color.new(color.blue, 0))plot(upper,   \"BB Upper\", color=color.new(color.green, 0))plot(lower,   \"BB Lower\", color=color.new(color.red, 0))plotshape(longTrig,  title=\"Nirvana True Duel BUY\",  style=shape.labelup,   color=color.green, text=\"NTD BUY\",  location=location.belowbar, size=size.tiny)plotshape(shortTrig, title=\"Nirvana True Duel SELL\", style=shape.labeldown, color=color.red,   text=\"NTD SELL\", location=location.abovebar, size=size.tiny)bgcolor(inSqueeze ? color.new(color.gray, 90) : na)alertcondition(longTrig,  \"Nirvana True Duel — Buy\",  \"Nirvana True Duel BUY Trigger\")alertcondition(shortTrig, \"Nirvana True Duel — Sell\", \"Nirvana True Duel SELL Trigger\")\n```"
  },
```

```
  {
    "input": "本策略基于 顺序三连穿越 原则：当 MA5 依次上穿 MA10、MA30、MA60 时，触发趋势做多信号；反之依次下穿时触发做空信号。",
    "output": "@version=6strategy(\"顺序三连穿越：2/3先入 + 3/3加仓（仅低波动过滤）\", overlay=true, initial_capital=100000, commission_type=strategy.commission.percent, commission_value=0.05, pyramiding=1, calc_on_order_fills=true, calc_on_every_tick=false, default_qty_type=strategy.percent_of_equity, default_qty_value=100)"
  },
```


# Empty
```
  "smart_money": {
    "description": "",
    "code": ""
  },
```

# Overall description:
```
  {
    "input": "🏆 Aurum Precision Scalper Pro v1.0SMMA 21/50/200 + RSI14 | Multi-Rule Gold Strategy (M3–M15)💡 OverviewAurum Precision Scalper Pro is a professional multi-rule intraday strategy built for scalping and day-trading XAUUSD (Gold) on short timeframes (3m, 5m, 15m).It combines RSI, SMMA trend filters, volume, and volatility logic with clean breakout and mean-reversion mechanics.Optimized for the London–New York overlap, this system captures directional moves while filtering out noise and false breakouts — the most common trap for gold traders.⚙️ Core Components1️⃣ Multi-Timeframe GuardrailWorks only on 3m / 5m / 15m charts for precision.Prevents accidental backtests on irrelevant timeframes.2️⃣ SMMA Trend FrameworkUses SMMA(21) for short-term bias,SMMA(50) for medium-term direction,SMMA(200) for higher-order trend control.RSI(14) confirms momentum and prevents chasing extreme moves.3️⃣ Global Filters✅ Trend filter (optional):• Longs only if close > SMMA200• Shorts only if close < SMMA200✅ SMMA proximity filters:• Blocks trades when SMMA21–SMMA50 or SMMA21–SMMA200 are too close → reduces chop.✅ Volume filter:• Requires volume > SMA(volume) × multiplier.✅ Impulse filter:• Body size ≥ k × ATR (volatility confirmation).✅ Active-session filter:• Default: 07:00–20:00 CET (Europe/Brussels).4️⃣ XAUUSD Preset (optional toggle)When symbol = “XAU” or “GOLD”, auto-applies gold-specific tuning:RSI thresholds tightened (BUY > 55 / SELL < 45)Stronger volume & volatility filtersStricter SMMA distance checksAutomatic session activation⚔️ Entry RulesRule\tSetup Type\tLogic SummaryR1\tFull SMMA breakout\tPrice closes above (or below) all SMMAs + RSI confirms directionR2\tSMMA21 touch + alignment\tPrice bounces on 21 while aligned with 50 & 200 + RSI filterR3\t3-bar engulfing reversal\tAfter 3 candles in one direction, an engulfing opposite bar + RSI momentumR4\tSMMA21/50 crossover\t21 crosses 50 with trend & volume confirmationAll rules respect your global filters (trend, volume, impulse, proximity, sessions).R2–R4 entries can be individually toggled ON/OFF in inputs.💰 Exit LogicSimple % exits (for quick prototyping):• TP = +X% (default 1.0%)• SL = −X% (default 0.5%)All entries are managed individually (R1–R4 IDs).More advanced versions include ATR-based partials, breakeven and dynamic trailing logic.🎨 VisualsSMMA21 → teal lineSMMA50 → orange lineSMMA200 → magenta lineOn-chart labels for each rule (BUY/SELL R1–R4).Alerts for all entry conditions — ready for automation or alerting bots.🧠 Suggested UsageBest window: 14:00–17:00 CET (London–New York overlap).Ideal timeframes: M5 and M15.Avoid over-trading during low volatility (Asian session).For XAUUSD, enable all filters for realistic conditions.Recommended baseline:TP = 1.0%SL = 0.5%UseVolFilter = trueUseImpulse = trueGapFilter = trueTrendFilter = true📈 Performance Tips✅ Stronger filter = fewer but higher-quality trades.✅ When gold volatility spikes (CPI/NFP/FOMC), increase “minGap%” thresholds slightly.✅ For smooth trend capture, use R4 (SMMA21/50 cross) with trend filters ON.✅ For reversals, combine R3 (engulfing) + RSI confirmation.🧾 Changelog (v1.0)✅ Multi-timeframe guard (3/5/15min only)✅ 4 rule logic (R1–R4)✅ Global filters: trend, volume, impulse, proximity✅ XAUUSD preset with adaptive parameters✅ Session/timezone logic✅ Simple exits for fast backtesting✅ On-chart labels and alert system🧭 Recommended Title / Tagline for TradingViewAurum Precision Scalper Pro v1.0“A high-precision RSI-SMMA strategy for Gold scalpers — designed for the London–NY overlap.”🔖 Tags#XAUUSD #Gold #Scalping #SMMA #RSI #Strategy #DayTrading #PineScriptV6 #ATR #TrendFollowing #BreakoutRelease NotesUpdateRelease NotesUpdateRelease Notesupdate",
    "output": "@version=6strategy(\"SMMA 21/50/200 + RSI14 -5/15m\", overlay=true, initial_capital=10000, calc_on_every_tick=true, pyramiding=0, max_bars_back=5000)"
  },
```

# Emoji
这个要不要去掉还是得看看？
  {
    "input": "🏆 Aurum Precision Scalper Pro v1.0SMMA 21/50/200 + RSI14 | Multi-Rule Gold Strategy (M3–M15)💡 OverviewAurum Precision Scalper Pro is a professional multi-rule intraday strategy built for scalping and day-trading XAUUSD (Gold) on short timeframes (3m, 5m, 15m).It combines RSI, SMMA trend filters, volume, and volatility logic with clean breakout and mean-reversion mechanics.Optimized for the London–New York overlap, this system captures directional moves while filtering out noise and false breakouts — the most common trap for gold traders.⚙️ Core Components1️⃣ Multi-Timeframe GuardrailWorks only on 3m / 5m / 15m charts for precision.Prevents accidental backtests on irrelevant timeframes.2️⃣ SMMA Trend FrameworkUses SMMA(21) for short-term bias,SMMA(50) for medium-term direction,SMMA(200) for higher-order trend control.RSI(14) confirms momentum and prevents chasing extreme moves.3️⃣ Global Filters✅ Trend filter (optional):• Longs only if close > SMMA200• Shorts only if close < SMMA200✅ SMMA proximity filters:• Blocks trades when SMMA21–SMMA50 or SMMA21–SMMA200 are too close → reduces chop.✅ Volume filter:• Requires volume > SMA(volume) × multiplier.✅ Impulse filter:• Body size ≥ k × ATR (volatility confirmation).✅ Active-session filter:• Default: 07:00–20:00 CET (Europe/Brussels).4️⃣ XAUUSD Preset (optional toggle)When symbol = “XAU” or “GOLD”, auto-applies gold-specific tuning:RSI thresholds tightened (BUY > 55 / SELL < 45)Stronger volume & volatility filtersStricter SMMA distance checksAutomatic session activation⚔️ Entry RulesRule\tSetup Type\tLogic SummaryR1\tFull SMMA breakout\tPrice closes above (or below) all SMMAs + RSI confirms directionR2\tSMMA21 touch + alignment\tPrice bounces on 21 while aligned with 50 & 200 + RSI filterR3\t3-bar engulfing reversal\tAfter 3 candles in one direction, an engulfing opposite bar + RSI momentumR4\tSMMA21/50 crossover\t21 crosses 50 with trend & volume confirmationAll rules respect your global filters (trend, volume, impulse, proximity, sessions).R2–R4 entries can be individually toggled ON/OFF in inputs.💰 Exit LogicSimple % exits (for quick prototyping):• TP = +X% (default 1.0%)• SL = −X% (default 0.5%)All entries are managed individually (R1–R4 IDs).More advanced versions include ATR-based partials, breakeven and dynamic trailing logic.🎨 VisualsSMMA21 → teal lineSMMA50 → orange lineSMMA200 → magenta lineOn-chart labels for each rule (BUY/SELL R1–R4).Alerts for all entry conditions — ready for automation or alerting bots.🧠 Suggested UsageBest window: 14:00–17:00 CET (London–New York overlap).Ideal timeframes: M5 and M15.Avoid over-trading during low volatility (Asian session).For XAUUSD, enable all filters for realistic conditions.Recommended baseline:TP = 1.0%SL = 0.5%UseVolFilter = trueUseImpulse = trueGapFilter = trueTrendFilter = true📈 Performance Tips✅ Stronger filter = fewer but higher-quality trades.✅ When gold volatility spikes (CPI/NFP/FOMC), increase “minGap%” thresholds slightly.✅ For smooth trend capture, use R4 (SMMA21/50 cross) with trend filters ON.✅ For reversals, combine R3 (engulfing) + RSI confirmation.🧾 Changelog (v1.0)✅ Multi-timeframe guard (3/5/15min only)✅ 4 rule logic (R1–R4)✅ Global filters: trend, volume, impulse, proximity✅ XAUUSD preset with adaptive parameters✅ Session/timezone logic✅ Simple exits for fast backtesting✅ On-chart labels and alert system🧭 Recommended Title / Tagline for TradingViewAurum Precision Scalper Pro v1.0“A high-precision RSI-SMMA strategy for Gold scalpers — designed for the London–NY overlap.”🔖 Tags#XAUUSD #Gold #Scalping #SMMA #RSI #Strategy #DayTrading #PineScriptV6 #ATR #TrendFollowing #BreakoutRelease NotesUpdateRelease NotesUpdateRelease Notesupdate",
    "output": "@version=6strategy(\"SMMA 21/50/200 + RSI14 -5/15m\", overlay=true, initial_capital=10000, calc_on_every_tick=true, pyramiding=0, max_bars_back=5000)"
  },